<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>JBCDIC Encoder/Decoder: JBCDIC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JBCDIC Encoder/Decoder
   &#160;<span id="projectnumber">1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">JBCDIC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BCDIC (Binary-Coded Decimal Interchange Code) adapted to support the part of ASCII necessary to represent JSON data to compress most characters into 4 bits. An escape mechanism allows UTF-8 strings to be inserted as is.</p>
<p>Problem: Sending JSON like data (mostly numerical) by Radio must be done in a compressed way. Compression algorithms are often complex and not "programmer friendly". We make a proposal based on the lessons of history, the BCDIC from the 1930's (never underestimate our ancestors!): <a href="https://en.wikipedia.org/wiki/BCD_(character_encoding)#IBM_704_BCD_code">https://en.wikipedia.org/wiki/BCD_(character_encoding)#IBM_704_BCD_code</a> .</p>
<p>It is bewildering to see how many proposals exist for Radio Data compression (list in reference at the end of this document). We reviewed many and makes this proposal anyway: if a reader would like to compare the compression rate with real and representative data (example: <a href="https://www.epj-conferences.org/articles/epjconf/pdf/2017/31/epjconf_incape2017_01073.pdf">https://www.epj-conferences.org/articles/epjconf/pdf/2017/31/epjconf_incape2017_01073.pdf</a>), we would be delighted !</p>
<p>The reader may like to have in mind the JSON specification: <a href="https://tools.ietf.org/html/rfc7159">https://tools.ietf.org/html/rfc7159</a></p>
<p>JBCDIC is at first a representation of JSON data (UTF8 strings excepted) in a basic set of 48 characters (completed by a second one of the same size). And thereafter, it is a compression of those characters in 4 bits chunks.</p>
<p>Let's take an example of data transmitted:</p>
<p><code>[{timestamp:316123456,battery:3.71,temperature:21.3,humidity:67.2,lumens:400,co2:1134,button:false,adc:null},{timestamp:316123516,battery:3.7,temperature:21.35,humidity:67,lumens:480,co2:1156,button:true,adc:567}]</code></p>
<p>(we suppose timestamp is the number of seconds since a given date and we are 10 years later)</p>
<p>The compression is done using three levels:</p>
<p>1) Reduction of fields names and values: the fields names are reduced to one or few upper case letters or digits ("\_" also allowed). Special values like <em>true</em>, <em>false</em>, <em>null</em> are represented with a "+" and one upper case letter (+T,+F,+N). Remaining upper case letters can be used for any other repeating string or number in the data. Translation dictionaries must be managed at application level.</p>
<p>2) Reduction of punctuation: spacing is discarded, ":" is discarded between names and values, "," is discarded between members of an object and between values of an array. Values can be:</p><ul>
<li>UTF-8 strings: an escape character starts the string (row 3, character 0) and an "invalid UTF-8" character (255, 0xFF) ends the UTF-8 string</li>
<li><code>'strings'</code> or <code>"strings"</code></li>
<li><code>+number+</code> or <code>-number+</code> for positive or negative integers. For all numerical values, the final "+" is necessary only if a negative number is following (only in arrays of values)</li>
<li><code>+number-decimals+</code> or <code>-number-decimals+</code></li>
<li><code>+number-decimals-positive exponent+</code> or <code>+number-decimals--negative exponent+</code></li>
<li>other numerical structures like time or longitude could be represented using "-" as a delimiter between parts of the structure</li>
</ul>
<p>3) The resulting string is compressed using an encoding table providing 4 bits per character and a row switching mechanism. We expect most data to be encoded using the row 0 (digits, +, - ) and only 4 bits for each of those characters.</p>
<p>4) When sending, the 4 last bits of the last byte can be empty: they can be filled by a chunk with a value between 12 and 15.</p>
<p>Our example after 1) and 2) becomes:</p>
<p><code>[{TS+316123456B+3-71T+21-3H+67-2L+400C2+1134U+FA+N}{TS+316123516B+3-7T+21-35H+67L+480C2+1156U+TA+567}]</code></p>
<p>103 characters remaining out of 215 characters: a compression of 52% (not counting any original spacing)</p>
<p>Below, the same with stars where the 4 bits compression needs "row shifts" (4 bits cost): <code>*[*{*TS*+316123456*B*+3-71*T*+21-3*H*+67-2*L*+400*C*2+1134*U*+*FA*+*N*}{*TS*+316123516*B*+3-7*T*+21-35*H*+67*L*+480*C*2+1156*U*+*T*A*+567*}*]</code></p>
<p>140 chunks of 4 bits (70 bytes) are produced for 103 characters: a compression of 42%.</p>
<p>A total compression from "raw" JSON (no spacing) of 66% using realistic data.</p>
<p>Notes:</p><ul>
<li>Application dictionary of names and values is essential to achieve a good performance.</li>
<li>Acronyms may have to be chosen taking into account the rows in the encoding table (to avoid row shifts). For instance, using "RP" (record period) instead of "TS" for the timestamp would remove a byte from the resulting string.</li>
<li>One may see that with a maximum data packet size of 53 bytes in LoRa: we would not send two sets of those example measures in one message.</li>
<li>Timestamp is often represented using 4 bytes (binary representation): we are using 5 bytes for <code>+316123456</code></li>
<li>Small floating points numbers like temperature are often represented by 4 bytes in in binary format (single precision: 7 significant digits, well explained here <a href="http://www.cse.hcmut.edu.vn/~hungnq/courses/501120/docthem/Single%20precision%20floating-point%20format%20-%20Wikipedia.pdf">http://www.cse.hcmut.edu.vn/~hungnq/courses/501120/docthem/Single%20precision%20floating-point%20format%20-%20Wikipedia.pdf</a> ). We are using 2 bytes for <code>21.5</code>, 3 bytes for <code>-12.34</code> and 4.5 for <code>-123.4567</code> (6 bytes for <code>-1234567---4</code> which means _-1234567e-4_) : BCD is very competitive compared to binary and keeps the flexibility of a character based representation of data (grammar driven encoding/decoding)</li>
<li>One more byte can also be saved by assuming a message is always an array of objects (measures sets): the opening and closing brackets can be assumed.</li>
</ul>
<h2>Table of 48 characters in 4 rows of 16 codes</h2>
<p>We have 2 x 48 possible characters: 26 letters, 10 digits, punctuation and escape to UTF-8 A string always starts in Upper Case, row 0.</p>
<p>UPPER case Table:</p>
<table class="doxtable">
<tr>
<th>row</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>A (10)</th><th>B (11)</th><th>C (12)</th><th>D (13)</th><th>E (14)</th><th>F (15)  </th></tr>
<tr>
<td>r0</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>+</td><td>-</td><td>Lower</td><td>r1</td><td>r2</td><td>r3 </td></tr>
<tr>
<td>r1</td><td>\'</td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>G</td><td>H</td><td>I</td><td>[</td><td>]</td><td>r0</td><td>Lower</td><td>r2</td><td>r3 </td></tr>
</table>
<p>r2|"|J|K|L|M|N|O|P|Q|R|| </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
